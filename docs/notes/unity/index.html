<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Unity 覚書 | HideOut</title>
<meta name="keywords" content="Unity">
<meta name="description" content="Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 &#43; Visual Studio 2022． 資料 適宜追加． オンライン Unity ユーザーマニュアル（日本語） C# プログラミング ガイド Unity">
<meta name="author" content="">
<link rel="canonical" href="https://ivorypawn.github.io/notes/unity/">
<link crossorigin="anonymous" href="https://ivorypawn.github.io/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ivorypawn.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ivorypawn.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ivorypawn.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ivorypawn.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://ivorypawn.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>




<style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }

        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
</style>


<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
<meta property="og:title" content="Unity 覚書" />
<meta property="og:description" content="Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 &#43; Visual Studio 2022． 資料 適宜追加． オンライン Unity ユーザーマニュアル（日本語） C# プログラミング ガイド Unity" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ivorypawn.github.io/notes/unity/" /><meta property="article:section" content="notes" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unity 覚書"/>
<meta name="twitter:description" content="Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 &#43; Visual Studio 2022． 資料 適宜追加． オンライン Unity ユーザーマニュアル（日本語） C# プログラミング ガイド Unity"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Notes",
      "item": "https://ivorypawn.github.io/notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Unity 覚書",
      "item": "https://ivorypawn.github.io/notes/unity/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Unity 覚書",
  "name": "Unity 覚書",
  "description": "Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 + Visual Studio 2022． 資料 適宜追加． オンライン Unity ユーザーマニュアル（日本語） C# プログラミング ガイド Unity",
  "keywords": [
    "Unity"
  ],
  "articleBody": "Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 + Visual Studio 2022．\n資料 適宜追加．\nオンライン Unity ユーザーマニュアル（日本語） C# プログラミング ガイド Unity 入門の森 入門 Unity @KINDAI Info-Tech HUB Unity 開発に関する 50 の Tips 〜ベストプラクティス〜 (2016 Edition) (非公式和訳）Unity - level up your code with game programming patterns Unity「2Dゲーム開発全般をカバーする本（英語）」を日本語で読む 書籍 Harrison Ferrone / 吉川 邦夫 訳 (2021)『Unity 3D ゲーム開発ではじめる C# プログラミング』 北村 愛実 (2016)『Unity 5 の教科書』 赤坂 玲音 (2015)『エンジニアのための Unity 実践リファレンス』 岩井 雅幸 (2015)『uGUI ではじめる Unity UI デザインの教科書』 導入 Unity Hub インストール 2019 年からバージョン管理ソフトになった．Hub から適宜旧バージョンを入れられる Unity 2022 インストール 歯車 \u003e Add modules Unity Editor おもな GUI 構成要素：\nToolbar（上段のリボン状のパネル） Hierarchy（左カラム） Scene, Game（中央） Inspector（右カラム） Project, Console（下段） レベル構築 アウトドア環境 Terrain インドア環境 shape, geometry インポート（Blender など） Material 任意の GameObject はマテリアルとシェーダーをもつ．\nマテリアルは，GameObject がどうレンダリングされるかを決定する．シェーダーはライティングとテクスチャデータの組み合わせからなり，マテリアルを制御する．\n(Misc) 原則 Unity エディタ以外からファイル操作するとバグる可能性があるのでやらない\nプロジェクトを zip 圧縮しない\nmeta が壊れる 7z ならオーケーらしい Inspector のコンポーネント横の情報アイコンからマニュアルに飛べる\nコンポーネントの public 変数は Inspector で一時変更できる（private 変数は無理）．この変更はスクリプトを書き換えない．再生中の変更は停止するともとに戻る\nInspector 上でスクリプトの初期値に戻すこともできる(Reset) 同じディレクトリで定義したクラスは，アタッチや using なしに参照される．これらのクラスと同様，デフォルトで入っている Transform, Camera などのコンポーネントは，再生時，メンバやメソッドをもつオブジェクトとしてメモリ上に展開される\nUnity の 2D は 3D シーンを平面に投影したもの．エディタの基本操作はほぼ共通\n3D で Y 軸が上向きなのはそのため シーンビューに配置した画像は スプライト と呼ばれる\n最初にスケールを決定して，すべて同じスケールになるようにビルドする\n3D なら $1\\,\\mathrm{unity\\ unit} = 1\\,\\mathrm{m}$，2D なら $1\\,\\mathrm{unity\\ unit} = 1\\,\\mathrm{pixel}$ など（参照） Visual Studio エディタで適当に C# スクリプトを作ってダブルクリックし Visual Studio で開く．何も起こらなければ Edit \u003e Preference \u003e External Tools \u003e External Script Editor から設定（これを忘れると入力補完が使えなかったりした）．\n(Misc) ファイル名とクラス名は一致させる．VS で勝手に変えるとたぶんバグる 変更は Project から 基底の MonoBehaviour は「シーン中のオブジェクトにアタッチできるクラス」の謂 エディタと VS が同期しない Project から当該ファイルを Refresh Edit \u003e Preference \u003e Asset Pipeline から Auto Refresh にすることもできる エディタのフォーカス時に自動コンパイルが走る メソッドの真上の行で /// を入力すると タグの枠が自動補完される アタッチしたオブジェクトの確認 途中から参加するプロジェクトなど，どのコンポーネントがどのオブジェクトにアタッチされているのかわからないとき，調べる方法はおもに二つ．\nProject のスクリプトを右クリック \u003e Find Reference In Scene で，Hierarchy がアタッチされているシーンに絞り込まれる ヒエラルキーの検索欄をクリアするともとに戻る オブジェクトの検索はできないので，インデックスを作成して検索するを導入するか，調べたいリソースの meta ファイル内の guid でプロジェクト全体を find する（Linux の grep） Start() に Debug.Log($\"{name}\") を挿入して実行 C++ との違い C++ との違いを適宜メモしていく．\nクラスと構造体 class は参照型，struct は値型になる．また string などが参照型になる．\npublic class Character { public string name; public Character(string name) { this.name = name; } public void print() { Debug.LogFormat(\"name: {0}\", name); } } void Start() { var taro = new Character(\"taro\"); taro.print(); // taro var jiro = taro; jiro.name = \"jiro\"; taro.print(); // jiro } 雑に作る もろもろを『Unity 5 の教科書』のゲームを作りながら覚える．\n一般的なフロー 登場するオブジェクトを列挙する 動かすオブジェクトの コントローラスクリプト を書く オブジェクトを自動生成する ジェネレータスクリプト を書く UI を更新する 監督スクリプト を書く スクリプトを作る流れを考える Roulette ルーレットを作る．フロー 3., 4. は不要．\nコントローラスクリプトに，タップ（クリック）すると回転を始めて，徐々に減速する動作を記述する．\nInput.GetMouseButtonDown(0) 引数 0 が左クリック，1 が右クリック，2 が中央クリックに対応 transform.Rotate(x, y, z) 引数が X, Y, Z 軸の回転量に対応 SwipeCar フラグに車を寸止めするゲーム．監督スクリプトを作成する．\nスワイプ距離の取得，オブジェクト速度への適用 Input.GetMouseButtonUp(0) Input.mousePosition.x transform.Translate(x, 0, 0) 元位置を原点とするローカル座標 uGUI using UnityEngine.UI using UnityEngine とは別に必要 (GameObject).GetComponent() などが使えるようになる GameObject.Find() AudioSource コンポーネント UIText を追加すると UI 設計画面が作成される．UI 設計画面はゲームの設計画面よりはるかに大きいが，実行時はゲーム画面に対応する．\nEventSystem はユーザの入力を UI 部品に中継する．入力の割り当て，無効化，キーやマウスの設定変更などが可能．\n監督スクリプトは空のオブジェクトに渡す．\nGetComponent コンポーネントは GameObject の一つの性質，あるいは GameObject という箱に追加して機能実現する「設定資料」のようなもの．コンポーネントへのアクセスは，原則テンプレート関数 GetComponent を用いる．\n座標・回転：GetComponent() 物理挙動：GetComponent() 効果音：GetComponent() UI テキスト：GetComponent() スクリプト：car.GetComponent() etc. ただし座標取得などでよく使う Transform に限り，簡易的な car.transform.position.x のような書き方ができる．\nCatEscape 避けゲー．ジェネレータスクリプトで Prefab を生成する．\nInput.GetKeyDown(KeyCode.LeftArrow) etc. Vector2.magnitude Destroy(gameObject) gameObject は自身を指す 一時停止してヒエラルキービューを見ると実際にオブジェクトが消えている キャスト e.g. Instantiate(Prefab) as GameObject アンカーポイントによる画像配置 Play Mode 中でも編集が適用された (Misc) サンプルコードは干渉時に毎回 Find() を呼んでいるが，たぶん Start() で初期化するほうが効率がよい 旧 ver. Unity Editor で作業中，設定等に問題がないのに UnityEngine.UI の画像生成で MissingComponentException が出る不具合に遭遇した．旧 ver. でたまに起きるらしい．最新 ver. では普通に動いた．再インストールで直った報告も見かけた Destroy の挙動 サンプルコードは Update() のなかで Destroy(gameObject) を呼んだあと自身のメンバを参照する可能性があり，一見して危険に思えた．しかし Destroy(gameObject) の一行後に Debug.Log(gameObject.transform.position) としても，普通に直前の座標が返ってきた．\nObject.Destroy（公式ドキュメント） Unityにおけるnullチェック(1) - AがnullでなくともA == nullがtrueになる Unityにおけるnullチェック(2) - Destroyが何をしているか 上記によると，Destroy によってオブジェクトが破棄されるのは Update ループのあと．yield return して 1 フレーム待つと例外が返ってくる．\nなお即座に破棄する DestroyImmediate メソッドもあるが，ランタイムでの使用が推奨されていないらしい．\nPrefab $\\fallingdotseq$ 設計図 ヒエラルキービュー上のオブジェクトをプロジェクトビューにドラッグ \u0026 ドロップすると Prefab ができる．一度 Prefab を作れば，シーン中のオブジェクトは削除しても構わない．\nシーン中のプレハブは 1 つ 1 つが別個のインスタンスになる．\nブレハブに新しいオブジェクトを追加するときは，同じヒエラルキーにそのオブジェクトを作成し，右クリックから Added GameObject \u003e プレハブ'xxx'に適用．\nアウトレット接続 スクリプトにアウトレットを用意し，Inspector からアウトレットを経由してオブジェクトを代入することをアウトレット接続という．なお Outlet = コンセント（米英語）．\nこの例では ArrowGenerator のメンバに public GameObject arrowPrefab を用意し，インスペクタ上で Prefab をドラッグ \u0026 ドロップして紐づけしている．\nClimbCloud Jump King 的な．Physics チュートリアル．\n剛体：Add Component \u003e Physics 2D \u003e Rigidbody 2D デフォルトで重力や外力の影響を受ける．Body Type \u003e static でビューに固定 当たり判定：Add Component \u003e Physics 2D \u003e xxx Collider 2D 複数コライダでカプセル形状を作成 下部が球状なので Rigidbody 2D \u003e Constraint \u003e Freeze Rotation で転倒防止 (Under Construction)\n.meta について (Under Construction)\n",
  "wordCount" : "3346",
  "inLanguage": "ja",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ivorypawn.github.io/notes/unity/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "HideOut",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ivorypawn.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ivorypawn.github.io/" accesskey="h" title="HideOut (Alt + H)">HideOut</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ivorypawn.github.io/posts/" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="https://ivorypawn.github.io/notes/" title="notes">
                    <span>notes</span>
                </a>
            </li>
            <li>
                <a href="https://ivorypawn.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Unity 覚書<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>
    </h1>
    <div class="post-meta">

</div>
  </header>

  
<div class="toc side left">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#資料">資料</a>
      <ul>
        <li><a href="#オンライン">オンライン</a></li>
        <li><a href="#書籍">書籍</a></li>
      </ul>
    </li>
    <li><a href="#導入">導入</a></li>
    <li><a href="#unity-editor">Unity Editor</a>
      <ul>
        <li><a href="#レベル構築">レベル構築</a></li>
        <li><a href="#material">Material</a></li>
        <li><a href="#misc">(Misc)</a></li>
      </ul>
    </li>
    <li><a href="#visual-studio">Visual Studio</a>
      <ul>
        <li><a href="#misc-1">(Misc)</a></li>
      </ul>
    </li>
    <li><a href="#アタッチしたオブジェクトの確認">アタッチしたオブジェクトの確認</a></li>
    <li><a href="#c-との違い">C++ との違い</a>
      <ul>
        <li><a href="#クラスと構造体">クラスと構造体</a></li>
      </ul>
    </li>
    <li><a href="#雑に作る">雑に作る</a>
      <ul>
        <li><a href="#一般的なフロー">一般的なフロー</a></li>
        <li><a href="#roulette">Roulette</a></li>
        <li><a href="#swipecar">SwipeCar</a>
          <ul>
            <li><a href="#getcomponent"><code>GetComponent</code></a></li>
          </ul>
        </li>
        <li><a href="#catescape">CatEscape</a>
          <ul>
            <li><a href="#misc-2">(Misc)</a></li>
            <li><a href="#destroy-の挙動"><code>Destroy</code> の挙動</a></li>
            <li><a href="#prefab-fallingdotseq-設計図">Prefab $\fallingdotseq$ 設計図</a></li>
            <li><a href="#アウトレット接続">アウトレット接続</a></li>
          </ul>
        </li>
        <li><a href="#climbcloud">ClimbCloud</a></li>
      </ul>
    </li>
    <li><a href="#meta-について">.meta について</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>




 
  <div class="post-content"><p>Unity 備忘録を集約．初歩的な内容が中心．環境は Windows 10 + Visual Studio 2022．</p>
<h2 id="資料">資料<a hidden class="anchor" aria-hidden="true" href="#資料">#</a></h2>
<p>適宜追加．</p>
<h3 id="オンライン">オンライン<a hidden class="anchor" aria-hidden="true" href="#オンライン">#</a></h3>
<ul>
<li><a href="https://docs.unity3d.com/ja/current/Manual/index.html">Unity ユーザーマニュアル（日本語）</a></li>
<li><a href="https://learn.microsoft.com/ja-jp/dotnet/csharp/programming-guide/">C# プログラミング ガイド</a></li>
<li><a href="https://3dunity.org/">Unity 入門の森</a></li>
<li><a href="https://zenn.dev/sane21/books/b42ecebc457eb6/viewer/cf8cdb">入門 Unity @KINDAI Info-Tech HUB</a></li>
<li><a href="https://zenn.dev/sh1ch/books/4f49e00cfd92be082e1c/viewer/8a5619780235f1bc3f74">Unity 開発に関する 50 の Tips 〜ベストプラクティス〜 (2016 Edition)</a></li>
<li><a href="https://zenn.dev/twugo/books/21cb3a6515e7b8">(非公式和訳）Unity - level up your code with game programming patterns</a></li>
<li><a href="https://zenn.dev/sh1ch/books/35fbffce89f26b">Unity「2Dゲーム開発全般をカバーする本（英語）」を日本語で読む</a></li>
</ul>
<h3 id="書籍">書籍<a hidden class="anchor" aria-hidden="true" href="#書籍">#</a></h3>
<ul>
<li>Harrison Ferrone / 吉川 邦夫 訳 (2021)『<a href="https://book.impress.co.jp/books/1120101145">Unity 3D ゲーム開発ではじめる C# プログラミング</a>』</li>
<li>北村 愛実 (2016)『<a href="https://www.sbcr.jp/product/4797386790/">Unity 5 の教科書</a>』</li>
<li>赤坂 玲音 (2015)『<a href="https://gihyo.jp/book/2015/978-4-7741-7303-0">エンジニアのための Unity 実践リファレンス</a>』</li>
<li>岩井 雅幸 (2015)『<a href="https://book.mynavi.jp/supportsite/detail/9784839956400.html">uGUI ではじめる Unity UI デザインの教科書</a>』</li>
</ul>
<h2 id="導入">導入<a hidden class="anchor" aria-hidden="true" href="#導入">#</a></h2>
<ol>
<li><a href="https://unity.com/ja/download">Unity Hub</a> インストール
<ul>
<li>2019 年からバージョン管理ソフトになった．Hub から適宜旧バージョンを入れられる</li>
</ul>
</li>
<li>Unity 2022 インストール</li>
<li>歯車 &gt; <code>Add modules</code></li>
</ol>
<h2 id="unity-editor">Unity Editor<a hidden class="anchor" aria-hidden="true" href="#unity-editor">#</a></h2>
<p>おもな GUI 構成要素：</p>
<ul>
<li>Toolbar（上段のリボン状のパネル）</li>
<li>Hierarchy（左カラム）</li>
<li>Scene, Game（中央）</li>
<li>Inspector（右カラム）</li>
<li>Project, Console（下段）</li>
</ul>
<h3 id="レベル構築">レベル構築<a hidden class="anchor" aria-hidden="true" href="#レベル構築">#</a></h3>
<ul>
<li>アウトドア環境
<ul>
<li><a href="https://docs.unity3d.com/ja/2021.3/Manual/script-Terrain.html">Terrain</a></li>
</ul>
</li>
<li>インドア環境
<ul>
<li>shape, geometry</li>
</ul>
</li>
<li>インポート（Blender など）</li>
</ul>
<h3 id="material">Material<a hidden class="anchor" aria-hidden="true" href="#material">#</a></h3>
<p>任意の GameObject はマテリアルとシェーダーをもつ．</p>
<p>マテリアルは，GameObject がどうレンダリングされるかを決定する．シェーダーはライティングとテクスチャデータの組み合わせからなり，マテリアルを制御する．</p>
<h3 id="misc">(Misc)<a hidden class="anchor" aria-hidden="true" href="#misc">#</a></h3>
<ul>
<li>
<p>原則 Unity エディタ以外からファイル操作するとバグる可能性があるのでやらない</p>
</li>
<li>
<p>プロジェクトを zip 圧縮しない</p>
<ul>
<li>meta が壊れる</li>
<li>7z ならオーケーらしい</li>
</ul>
</li>
<li>
<p>Inspector のコンポーネント横の情報アイコンからマニュアルに飛べる</p>
</li>
<li>
<p>コンポーネントの <code>public</code> 変数は Inspector で一時変更できる（<code>private</code> 変数は無理）．この変更はスクリプトを書き換えない．再生中の変更は停止するともとに戻る</p>
<ul>
<li>Inspector 上でスクリプトの初期値に戻すこともできる(<code>Reset</code>)</li>
</ul>
</li>
<li>
<p>同じディレクトリで定義したクラスは，アタッチや <code>using</code> なしに参照される．これらのクラスと同様，デフォルトで入っている <code>Transform</code>, <code>Camera</code> などのコンポーネントは，再生時，メンバやメソッドをもつオブジェクトとしてメモリ上に展開される</p>
</li>
<li>
<p>Unity の 2D は 3D シーンを平面に投影したもの．エディタの基本操作はほぼ共通</p>
<ul>
<li>3D で Y 軸が上向きなのはそのため</li>
</ul>
</li>
<li>
<p>シーンビューに配置した画像は <strong>スプライト</strong> と呼ばれる</p>
</li>
<li>
<p>最初にスケールを決定して，すべて同じスケールになるようにビルドする</p>
<ul>
<li>3D なら $1\,\mathrm{unity\ unit} = 1\,\mathrm{m}$，2D なら $1\,\mathrm{unity\ unit} = 1\,\mathrm{pixel}$ など（<a href="https://zenn.dev/sh1ch/books/4f49e00cfd92be082e1c/viewer/a590091472434f75e0a1">参照</a>）</li>
</ul>
</li>
</ul>
<h2 id="visual-studio">Visual Studio<a hidden class="anchor" aria-hidden="true" href="#visual-studio">#</a></h2>
<p>エディタで適当に C# スクリプトを作ってダブルクリックし Visual Studio で開く．何も起こらなければ <code>Edit</code> &gt; <code>Preference</code> &gt; <code>External Tools</code> &gt; <code>External Script Editor</code> から設定（これを忘れると入力補完が使えなかったりした）．</p>
<h3 id="misc-1">(Misc)<a hidden class="anchor" aria-hidden="true" href="#misc-1">#</a></h3>
<ul>
<li>ファイル名とクラス名は一致させる．VS で勝手に変えるとたぶんバグる
<ul>
<li>変更は Project から</li>
<li>基底の <a href="https://docs.unity3d.com/ja/current/Manual/class-MonoBehaviour.html"><code>MonoBehaviour</code></a> は「シーン中のオブジェクトにアタッチできるクラス」の謂</li>
</ul>
</li>
<li>エディタと VS が同期しない
<ul>
<li>Project から当該ファイルを <code>Refresh</code></li>
<li><code>Edit</code> &gt; <code>Preference</code> &gt; <code>Asset Pipeline</code> から <code>Auto Refresh</code> にすることもできる
<ul>
<li>エディタのフォーカス時に自動コンパイルが走る</li>
</ul>
</li>
</ul>
</li>
<li>メソッドの真上の行で <code>///</code> を入力すると <code>&lt;summary&gt;</code> タグの枠が自動補完される</li>
</ul>
<h2 id="アタッチしたオブジェクトの確認">アタッチしたオブジェクトの確認<a hidden class="anchor" aria-hidden="true" href="#アタッチしたオブジェクトの確認">#</a></h2>
<p>途中から参加するプロジェクトなど，どのコンポーネントがどのオブジェクトにアタッチされているのかわからないとき，調べる方法はおもに二つ．</p>
<ul>
<li>Project のスクリプトを右クリック &gt; <code>Find Reference In Scene</code> で，Hierarchy がアタッチされているシーンに絞り込まれる
<ul>
<li>ヒエラルキーの検索欄をクリアするともとに戻る</li>
<li>オブジェクトの検索はできないので，インデックスを作成して検索するを導入するか，調べたいリソースの meta ファイル内の guid でプロジェクト全体を <code>find</code> する（Linux の <code>grep</code>）</li>
</ul>
</li>
<li><code>Start()</code> に <code>Debug.Log($&quot;{name}&quot;)</code> を挿入して実行</li>
</ul>
<h2 id="c-との違い">C++ との違い<a hidden class="anchor" aria-hidden="true" href="#c-との違い">#</a></h2>
<p>C++ との違いを適宜メモしていく．</p>
<h3 id="クラスと構造体">クラスと構造体<a hidden class="anchor" aria-hidden="true" href="#クラスと構造体">#</a></h3>
<p><code>class</code> は参照型，<code>struct</code> は値型になる．また <code>string</code> などが参照型になる．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Character</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Character</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">print</span><span class="p">()</span> <span class="p">{</span> <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&#34;name: {0}&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">void</span> <span class="n">Start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">taro</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Character</span><span class="p">(</span><span class="s">&#34;taro&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">taro</span><span class="p">.</span><span class="n">print</span><span class="p">();</span> <span class="c1">// taro</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">jiro</span> <span class="p">=</span> <span class="n">taro</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">jiro</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#34;jiro&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">taro</span><span class="p">.</span><span class="n">print</span><span class="p">();</span> <span class="c1">// jiro</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="雑に作る">雑に作る<a hidden class="anchor" aria-hidden="true" href="#雑に作る">#</a></h2>
<p>もろもろを『Unity 5 の教科書』のゲームを作りながら覚える．</p>
<h3 id="一般的なフロー">一般的なフロー<a hidden class="anchor" aria-hidden="true" href="#一般的なフロー">#</a></h3>
<ol>
<li>登場するオブジェクトを列挙する</li>
<li>動かすオブジェクトの <strong>コントローラスクリプト</strong> を書く</li>
<li>オブジェクトを自動生成する <strong>ジェネレータスクリプト</strong> を書く</li>
<li>UI を更新する <strong>監督スクリプト</strong> を書く</li>
<li>スクリプトを作る流れを考える</li>
</ol>
<h3 id="roulette">Roulette<a hidden class="anchor" aria-hidden="true" href="#roulette">#</a></h3>
<p>ルーレットを作る．フロー 3., 4. は不要．</p>
<p>コントローラスクリプトに，タップ（クリック）すると回転を始めて，徐々に減速する動作を記述する．</p>
<ul>
<li><code>Input.GetMouseButtonDown(0)</code>
<ul>
<li>引数 0 が左クリック，1 が右クリック，2 が中央クリックに対応</li>
</ul>
</li>
<li><code>transform.Rotate(x, y, z)</code>
<ul>
<li>引数が X, Y, Z 軸の回転量に対応</li>
</ul>
</li>
</ul>
<h3 id="swipecar">SwipeCar<a hidden class="anchor" aria-hidden="true" href="#swipecar">#</a></h3>
<p>フラグに車を寸止めするゲーム．監督スクリプトを作成する．</p>
<ul>
<li>スワイプ距離の取得，オブジェクト速度への適用
<ul>
<li><code>Input.GetMouseButtonUp(0)</code></li>
<li><code>Input.mousePosition.x</code></li>
<li><code>transform.Translate(x, 0, 0)</code>
<ul>
<li>元位置を原点とするローカル座標</li>
</ul>
</li>
</ul>
</li>
<li>uGUI
<ul>
<li><code>using UnityEngine.UI</code>
<ul>
<li><code>using UnityEngine</code> とは別に必要</li>
<li><code>(GameObject).GetComponent&lt;Text&gt;()</code> などが使えるようになる</li>
</ul>
</li>
</ul>
</li>
<li><code>GameObject.Find()</code></li>
<li>AudioSource コンポーネント</li>
</ul>
<p>UIText を追加すると UI 設計画面が作成される．UI 設計画面はゲームの設計画面よりはるかに大きいが，実行時はゲーム画面に対応する．</p>
<p><code>EventSystem</code> はユーザの入力を UI 部品に中継する．入力の割り当て，無効化，キーやマウスの設定変更などが可能．</p>
<p>監督スクリプトは空のオブジェクトに渡す．</p>
<h4 id="getcomponent"><code>GetComponent</code><a hidden class="anchor" aria-hidden="true" href="#getcomponent">#</a></h4>
<p>コンポーネントは <code>GameObject</code> の一つの性質，あるいは <code>GameObject</code> という箱に追加して機能実現する「設定資料」のようなもの．コンポーネントへのアクセスは，原則テンプレート関数 <code>GetComponent</code> を用いる．</p>
<ul>
<li>座標・回転：<code>GetComponent&lt;Transform&gt;()</code></li>
<li>物理挙動：<code>GetComponent&lt;Rigidbody&gt;()</code></li>
<li>効果音：<code>GetComponent&lt;AudioSource&gt;()</code></li>
<li>UI テキスト：<code>GetComponent&lt;Text&gt;()</code></li>
<li>スクリプト：<code>car.GetComponent&lt;CarController&gt;()</code> etc.</li>
</ul>
<p>ただし座標取得などでよく使う <code>Transform</code> に限り，簡易的な <code>car.transform.position.x</code> のような書き方ができる．</p>
<h3 id="catescape">CatEscape<a hidden class="anchor" aria-hidden="true" href="#catescape">#</a></h3>
<p>避けゲー．ジェネレータスクリプトで Prefab を生成する．</p>
<ul>
<li><code>Input.GetKeyDown(KeyCode.LeftArrow)</code> etc.</li>
<li><code>Vector2.magnitude</code></li>
<li><code>Destroy(gameObject)</code>
<ul>
<li><code>gameObject</code> は自身を指す</li>
<li>一時停止してヒエラルキービューを見ると実際にオブジェクトが消えている</li>
</ul>
</li>
<li>キャスト e.g. <code>Instantiate(Prefab) as GameObject</code></li>
<li>アンカーポイントによる画像配置
<ul>
<li>Play Mode 中でも編集が適用された</li>
</ul>
</li>
</ul>
<h4 id="misc-2">(Misc)<a hidden class="anchor" aria-hidden="true" href="#misc-2">#</a></h4>
<ul>
<li>サンプルコードは干渉時に毎回 <code>Find()</code> を呼んでいるが，たぶん <code>Start()</code> で初期化するほうが効率がよい</li>
<li>旧 ver. Unity Editor で作業中，設定等に問題がないのに <code>UnityEngine.UI</code> の画像生成で <code>MissingComponentException</code> が出る不具合に遭遇した．旧 ver. でたまに起きるらしい．最新 ver. では普通に動いた．再インストールで直った報告も見かけた</li>
</ul>
<h4 id="destroy-の挙動"><code>Destroy</code> の挙動<a hidden class="anchor" aria-hidden="true" href="#destroy-の挙動">#</a></h4>
<p>サンプルコードは <code>Update()</code> のなかで <code>Destroy(gameObject)</code> を呼んだあと自身のメンバを参照する可能性があり，一見して危険に思えた．しかし <code>Destroy(gameObject)</code> の一行後に <code>Debug.Log(gameObject.transform.position)</code> としても，普通に直前の座標が返ってきた．</p>
<ul>
<li><a href="https://docs.unity3d.com/ScriptReference/Object.Destroy.html">Object.Destroy（公式ドキュメント）</a></li>
<li><a href="https://qiita.com/msm2001/items/b57f6b92371026307c0b">Unityにおけるnullチェック(1) - AがnullでなくともA == nullがtrueになる</a></li>
<li><a href="https://qiita.com/msm2001/items/69a5ac3b1491723e756b">Unityにおけるnullチェック(2) - Destroyが何をしているか</a></li>
</ul>
<p>上記によると，<code>Destroy</code> によってオブジェクトが破棄されるのは <code>Update</code> ループのあと．<a href="https://learn.microsoft.com/ja-jp/dotnet/csharp/language-reference/statements/yield"><code>yield return</code></a> して 1 フレーム待つと例外が返ってくる．</p>
<p>なお即座に破棄する <code>DestroyImmediate</code> メソッドもあるが，ランタイムでの使用が推奨されていないらしい．</p>
<h4 id="prefab-fallingdotseq-設計図">Prefab $\fallingdotseq$ 設計図<a hidden class="anchor" aria-hidden="true" href="#prefab-fallingdotseq-設計図">#</a></h4>
<p>ヒエラルキービュー上のオブジェクトをプロジェクトビューにドラッグ &amp; ドロップすると Prefab ができる．一度 Prefab を作れば，シーン中のオブジェクトは削除しても構わない．</p>
<p>シーン中のプレハブは 1 つ 1 つが別個のインスタンスになる．</p>
<p>ブレハブに新しいオブジェクトを追加するときは，同じヒエラルキーにそのオブジェクトを作成し，右クリックから <code>Added GameObject</code> &gt; <code>プレハブ'xxx'に適用</code>．</p>
<h4 id="アウトレット接続">アウトレット接続<a hidden class="anchor" aria-hidden="true" href="#アウトレット接続">#</a></h4>
<p>スクリプトにアウトレットを用意し，Inspector からアウトレットを経由してオブジェクトを代入することをアウトレット接続という．なお Outlet = コンセント（米英語）．</p>
<p>この例では <code>ArrowGenerator</code> のメンバに <code>public GameObject arrowPrefab</code> を用意し，インスペクタ上で Prefab をドラッグ &amp; ドロップして紐づけしている．</p>
<h3 id="climbcloud">ClimbCloud<a hidden class="anchor" aria-hidden="true" href="#climbcloud">#</a></h3>
<p>Jump King 的な．Physics チュートリアル．</p>
<ul>
<li>剛体：<code>Add Component</code> &gt; <code>Physics 2D</code> &gt; <code>Rigidbody 2D</code>
<ul>
<li>デフォルトで重力や外力の影響を受ける．<code>Body Type</code> &gt; <code>static</code> でビューに固定</li>
</ul>
</li>
<li>当たり判定：<code>Add Component</code> &gt; <code>Physics 2D</code> &gt; <code>xxx Collider 2D</code>
<ul>
<li>複数コライダでカプセル形状を作成</li>
<li>下部が球状なので <code>Rigidbody 2D</code> &gt; <code>Constraint</code> &gt; <code>Freeze Rotation</code> で転倒防止</li>
</ul>
</li>
</ul>
<p>(Under Construction)</p>
<h2 id="meta-について">.meta について<a hidden class="anchor" aria-hidden="true" href="#meta-について">#</a></h2>
<p>(Under Construction)</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ivorypawn.github.io/tags/unity/">Unity</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ivorypawn.github.io/notes/wavelet-matrix/">
    <span class="title">« Prev</span>
    <br>
    <span>Wavelet Matrix</span>
  </a>
  <a class="next" href="https://ivorypawn.github.io/notes/stochastic-poisson-surface-reconstruction/">
    <span class="title">Next »</span>
    <br>
    <span>Stochastic Poisson Surface Reconstruction</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://ivorypawn.github.io/">HideOut</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
